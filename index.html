<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>MCSR Rules</title>
  <meta name="description" content="The official ruleset for Minecraft Speedrunning.">
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("js").remove()
      fetch("https://api.github.com/repos/Minecraft-Java-Edition-Speedrunning/rules/contents/pub/pdf")
        .then(res => {
          if (!res.ok) {
            document.getElementById("newest").innerText = "github api failed :("
            throw new Error("http error status: " + response.status);
          }
          return res.json();
        })
        .then(data => {
          data.sort((a, b) => {
            a = a.name; b = b.name;
            b1 = !a.includes("beta"); b2 = !b.includes("beta")
            if (b1 ^ b2) return b2 - b1 // boolean subtraction
            return b.split(".")[0].split("_").at(-1).substring(1) - a.split(".")[0].split("_").at(-1).substring(1) // string subtraction
          })
          quicklink = document.getElementById("quicklink")
          newest = data[0]
          quicklink.href = "https://rawcdn.githack.com/Minecraft-Java-Edition-Speedrunning/rules/main/pub/pdf/" + newest.name
          quicklink.innerText = newest.name
          for (ver of data) {
            url = "https://rawcdn.githack.com/Minecraft-Java-Edition-Speedrunning/rules/main/pub/pdf/" + ver.name
            changelog = "https://github.com/Minecraft-Java-Edition-Speedrunning/rules/releases/tag/" + ver.name.split(".")[0]
            releases.appendChild(document.createElement("li")).innerHTML = `<a href=${url}>${ver.name}</a>`
              + (!ver.name.includes("beta") ? `, <a href="${changelog}">changelog</a>` : "")
          }
        })
    })
  </script>
</head>

<body>
  <h1>MCSR Rules</h1>
  <h2 id="js">This site requires JavaScript!</h2>
  <h2 id="newest">Current: <a id="quicklink">loading</a></h2>
  <h3 id="rules">Past releases:</h3>
  <ul id="releases"></ul>
  <p>The rules are maintained on GitHub at <a
      href="https://github.com/Minecraft-Java-Edition-Speedrunning/rules">Minecraft-Java-Edition-Speedrunning/rules</a>.
    Use <a href="./latest">/latest</a> to always redirect to the current rules release.</p>
</body>

</html>

